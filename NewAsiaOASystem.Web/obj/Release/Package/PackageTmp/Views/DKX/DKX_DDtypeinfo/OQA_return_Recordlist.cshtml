@{
    ViewBag.Title = "非标品保审核异常统计数据";
    Layout = "~/Views/Shared/_SysLayout.cshtml";
}



@section HeadContent{

    <script type="text/javascript">
        $(function () {
            Gettabledata();
        })


        function Gettabledata() {
            var gcsid = $("#txtGCS").val();
            var ddbianhao = $("#txt_DD_Bianhao").val();
            var c_timestart = $("#txt_startctime").val();
            var c_timeend = $("#txt_endctiome").val();
            var cbrId = $("#CBRId").val()
            layui.use('table', function () {
                var table = layui.table;
                table.render({
                    elem: '#tabledata',
                    url: '/DKX_DDtypeinfo/GetProductionreturnRecorddataNoPage',
                    where: {
                        gcsid: gcsid,
                        ddbianhao: ddbianhao,
                        c_timestart: c_timestart,
                        c_timeend: c_timeend,
                        CBRId: cbrId,
                        caozuotype: '1'
                    },
                    cols: [[
                        { field: 'Id', width: 80, title: 'ID', sort: true, },
                        { field: 'dd_bianhao', width: 200, title: '生产批号' },
                        {
                            field: 'gcs_Id', width: 200, title: '责任工程师', templet: function (d) {
                                return getgcsname(d.gcs_Id)
                            }
                        },
                        {
                            field: 'caozuo', width: 300, title: '品保操作'
                        },
                        { field: 'CBRRemarks', width: 300, title: '备注' },
                        {
                            field: 'c_time', width: 120, title: '异常时间', templet: function (d) {
                                if (d.c_time != "" && d.c_time != null) {
                                    return layui_dateToStr(d.c_time);
                                }
                                else {
                                    return "";
                                }
                            }
                        },
                       

                        //{ field: '', title: '操作', width: 160, fixed: 'right', toolbar: "#bar" }
                    ]],
                    done: function (res, curr, count) {
                        $(".layui-table-box").find("[data-field='Id']").css("display", "none");
                        console.log("count:", count);
                        $("#tdtotle").html("当前品保异常次数： " + count + "/次");
                    }
                    ,
                    page: false,
                    height: 'full-150',


                });
                table.on('tool(tabledata)', function (obj) {
                    var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
                    var data = obj.data; //获得当前行 tr 的 DOM 对象（如果有的话）
                    //if (layEvent === 'Eide') { //查看
                    //    openDelay_SCtimeView(data.Id);
                    //}
                    //if (layEvent === 'JHEide') {
                    //    MakePlan(data.Id, data.Isscing, "0")
                    //}

                })
            })
        }

             //根据工程师的Id 返回工程师的名称
        function getgcsname(id) {
            var jsonstr=@Html.Raw(ViewBag.MyJson);
            if(id!=null)
            {
                var str;
                if(jsonstr!=null){
                    for (var i = 0;i <jsonstr.length; i++)
                    {
                        if(jsonstr[i].Id==id)
                        {
                            str=jsonstr[i].Name
                        }
                    }
                    if(str!=null)
                    {
                        return str
                    }
                    else
                    {
                        return '-'
                    }
                }
            }else
            {
                return '--';
            }
        }

        function Exportexcl() {
            var gcsid = $("#txtGCS").val();
            var ddbianhao = $("#txt_DD_Bianhao").val();
            var c_timestart = $("#txt_startctime").val()
            var c_timeend = $("#txt_endctiome").val()
        
            //if (c_timestart == "" || c_timestart == null) {
            //配置一个透明的询问框
            layer.msg('操作时间默认当前月份', {
                time: 2500, //2.5s后自动关闭
                btn: ['确定导出', '取消'],
                yes: function () {
                    window.location.href = "../DKX_DDtypeinfo/DC_OQA_return_Record_FilResult?gcsid=" + gcsid + "&ddbianhao=" + ddbianhao + "&c_timestart=" + c_timestart + "&c_timeend=" + c_timeend +"&caozuotype=1";
                }
            });
        }
    </script>

    }

    <div style="width: 98%; margin: auto; margin-top: 10px;">
        <div class="inquiry1">
            <fieldset>
                <legend>查询条件</legend>
                <ul>
                    <li>
                        <span>生产批号：</span>
                        <span class="inquiry-input">
                            <input type="text" name="txt_DD_Bianhao" placeholder="订单编号" id="txt_DD_Bianhao" />
                        </span>
                    </li>
                    <li>
                        <span>工程师：</span>
                        <span class="inquiry-input">
                            @Html.DropDownList("txtGCS", ViewData["GCSDATA"] as SelectList)
                        </span>
                    </li>
                    @*<li>
                            <span>退单原因：</span>
                            <span class="inquiry-input">
                                @Html.DropDownList("CBRId", ViewData["SCCBRTlist"] as SelectList)
                            </span>
                        </li>*@
                    <li>
                        <span>操作时间：</span>
                        <span class="inquiry-input">
                            <input type="text" name="txt_startctime" id="txt_startctime" autocomplete="off" placeholder="默认当前自然月" onclick="WdatePicker()" />
                            -
                            <input type="text" name="txt_endctiome" id="txt_endctiome" autocomplete="off" placeholder="默认当前自然月" onclick="WdatePicker()" />
                        </span>
                    </li>
                    <li style="*width: 100%; *margin: -10px 0 5px 90px;">
                        <span class="inquiry-input">
                            <button name="btnSerch" class="layui-btn" onclick="return Gettabledata()"><i class="layui-icon">&#xe615;</i>查询</button>
                        </span>
                        <span class="inquiry-input">
                            <button name="btnSerch" class="layui-btn" onclick="return myrefresh()"><i class="layui-icon">&#xe9aa;</i>刷新</button>
                        </span>
                        <span class="inquiry-input">
                            <button type="button" onclick="return Exportexcl()">记录导出</button>
                        </span>
                    </li>
                </ul>
            </fieldset>
        </div>
        <div id="content" style="width: 100%;height:10%">
            <span class="layui-badge" id="tdtotle"></span>
            <table class="layui-hide" id="tabledata" lay-filter="tabledata"></table>
        </div>
    </div>

    <script src="~/Scripts/NAjs/DKXpulice.js"></script>