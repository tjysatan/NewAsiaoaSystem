@model NewAsiaOASystem.ViewModel.EP_jlinfoView
@{
    ViewBag.Title = "顺丰快递打印";
    Layout = "~/Views/Shared/_SysLayout.cshtml";
}

<script src="~/Scripts/Printjs/LodopFuncs.js" type="text/javascript"></script>
<script src="~/Scripts/NAjs/Printjs.js"></script>

@{
    <script type="text/javascript">
    $(function () {
        getLodop();
    })

        var LODOP; //声明为全局变量
        function myPreview() {

            //LODOP.ADD_PRINT_SETUP_BKIMG("<img border='0' width='76px'");
            //LODOP.PRINT_INITA(0,0,76,130,"打印控件功能演示_Lodop功能_自定义纸张2");
		   //LODOP.SET_PRINTER_INDEX(getSelectedPrintIndex());
		    //LODOP.SET_PRINT_PAGESIZE(1);
            //LODOP.PRINT_INITA(0, 0, "76px", "130px", "");
            LODOP.PRINT_INIT("二级模板");

	        LODOP.SET_PRINT_PAGESIZE(0,"100mm","150mm","CreateCustomPage");
            //第一块线 高度 15mm
            LODOP.ADD_PRINT_LINE("15mm",0,"15mm","110mm",0,1);
            //LODOP.ADD_PRINT_RECT(0, "35mm", 1, "15mm", 0, 0);//竖线
            //LODOP.ADD_PRINT_RECT("7.5mm", "35mm", "35mm", 1, 0, 0);//横线
            // LODOP.ADD_PRINT_RECT(0, "70mm", 1, "15mm", 0, 0);//竖线
            //第2块线 高度 16mm
            LODOP.ADD_PRINT_LINE("40mm", 0, "40mm", "100mm", 0, 1);
            //第3块线 高度 40mm
            LODOP.ADD_PRINT_LINE("76mm", 0, "76mm", "100mm", 0, 1);
            //LODOP.ADD_PRINT_LINE("40mm", 0, "40mm", "110mm", 0, 1);
            //LODOP.ADD_PRINT_LINE("30mm", "70mm", "40mm", "70mm", 0, 1);
            //第4块
            LODOP.ADD_PRINT_LINE("100mm", 0, "100mm", "100mm", 0, 1);
            LODOP.ADD_PRINT_LINE("76mm", "35mm", "100mm", "35mm", 0, 1);//竖线
            LODOP.ADD_PRINT_LINE("88mm", 0, "88mm", "35mm", 0, 1);
            LODOP.ADD_PRINT_LINE("76mm", "70mm", "100mm", "70mm", 0, 1);//竖线
            LODOP.ADD_PRINT_LINE("88mm", "70mm", "88mm", "115mm", 0, 1);
            //第5块 寄
            LODOP.ADD_PRINT_LINE("120mm", 0, "120mm", "110mm", 0, 1);


            CreateFullBill();
            //LODOP.SET_PRINT_STYLEA(0, "AngleOfPageInside", 180);
            //LODOP.SET_SHOW_MODE("BKIMG_IN_PREVIEW", 1); //注："BKIMG_IN_PREVIEW"-预览包含背景图 "BKIMG_IN_FIRSTPAGE"- 仅首页包含背景图
            LODOP.PREVIEW(); //打印预览
            Closetk();
        };
        function Design1() {
            CreateFullBill();
            //LODOP.ADD_PRINT_SETUP_BKIMG("<img border='0' width='76px'");
            SET_PRINT_ModelAGESIZE(intOrient,intPageWidth,intPageHeight,strPageName);
            LODOP.PRINT_DESIGN();
        };
       function CreateFullBill() {
           LODOP = getLodop();
           LODOP.SET_PRINT_STYLE("FontColor", 16711680);
           LODOP.SET_PRINT_STYLE('FontSize', 22);
           LODOP.ADD_PRINT_TEXT("2mm", "70mm", "30mm", "10mm", '@Model.proCode');
           var fkfs = '第一次打印时间' + '@Model.Jjdatetime';
           LODOP.SET_PRINT_STYLE('FontSize', 10);
           LODOP.ADD_PRINT_TEXT("10mm","10mm","100mm","5mm",fkfs);
           //第2块 条形码
           LODOP.ADD_PRINT_BARCODE("20mm", "20mm", "70mm", "18mm", "128Auto", '@Model.Kd_no');
           LODOP.ADD_PRINT_TEXT("32mm", "10mm", "20mm", "5mm", "单号");//

           //第3块

           var qxname;
           var sname;//收货人
           var sdw;//收货单位
           var stel;//收货电话
            var sAdress;//收货地址
          if('@Model.SjaddId'!=null&&'@Model.SjaddId'!=""){
              var khinfo = AjaxAddresseeinfobyCustId('@Model.SjaddId');//客户信息
               var Cus_info1 = AjaxCust_Name('@Model.SjId');
            qxname = khinfo.qyt;
            sname = khinfo.Aname;//收货人
              sdw = Cus_info1.Name;//收货单位
            stel = khinfo.Tel;//收货电话
            sAdress = khinfo.Address;//收货地址
          } else {
              var Cus_info = AjaxCust_Name('@Model.SjId');
                 qxname = Cus_info.qyqxname;
                 sname = Cus_info.LxrName;//收货人
                 sdw = Cus_info.Name;//收货单位
                 stel = Cus_info.Tel;//收货电话
                 sAdress = Cus_info.Adress;//收货地址
           }

           stel = "" + stel;
           var reg = /(\d{3})\d{4}(\d{4})/;
           var tel1 = stel.replace(reg, "$1****$2")
           //第3块
           LODOP.SET_PRINT_STYLE('FontSize', 30);
           LODOP.ADD_PRINT_TEXT("42mm", "10mm", "50mm", "10mm", '@Model.destRouteLabel');
           //3-1收
           LODOP.SET_PRINT_STYLE('FontSize', 28);
           LODOP.ADD_PRINT_TEXT("55mm", "1mm", "20mm", "20mm", "收");
           LODOP.SET_PRINT_STYLE('FontSize', 12);
           LODOP.ADD_PRINT_TEXT("55mm", "15mm", "20mm", "5mm", sname);//1行 收件人
           LODOP.ADD_PRINT_TEXT("55mm", "35mm", "80mm", "5mm", tel1);//1行 收件人电话
           LODOP.ADD_PRINT_TEXT("60mm", "15mm", "70mm", "10mm", sAdress);//2行 收件地址
           LODOP.ADD_PRINT_TEXT("70mm", "15mm", "70mm", "5mm", sdw);//2行 收件地址

           var aaaaa = '@Model.twoDimensionCode'

           for (var i = 0; i < 28; i++) {
               aaaaa = aaaaa.replace('&#39;', '\'');
           }
           console.log('111111', aaaaa);
           //第4块
           LODOP.ADD_PRINT_TEXT("80mm", "5mm", "35mm", "10mm", "已验视");// 已验视
           LODOP.SET_PRINT_STYLE('FontSize', 30);
           LODOP.ADD_PRINT_TEXT("90mm", "5mm", "35mm", "20mm", '@Model.codingMapping');//
           LODOP.ADD_PRINT_BARCODE("76.5mm", "40mm", "32mm", "32mm", "QRCode", aaaaa);//二维码
           LODOP.SET_PRINT_STYLE('FontSize', 14);
           LODOP.ADD_PRINT_TEXT("80mm", "75mm", "35mm", "10mm", '@Model.proName');// proName
           LODOP.SET_PRINT_STYLE('FontSize', 30);
           LODOP.ADD_PRINT_TEXT("90mm", "75mm", "35mm", "20mm", '@Model.codingMappingOut');//

            //第5块 寄
              var userinfo = AjaxPerson_Name('@Model.JjId');//当前登录的用户信息
           var fname = userinfo.UserName;//发货人
           var ftel = userinfo.Tel;//发货人电话
           ftel = "" + ftel;
           var ftel1 = ftel.replace(reg, "$1****$2")
           LODOP.SET_PRINT_STYLE('FontSize', 28);
           LODOP.ADD_PRINT_TEXT("105mm", "2mm", "20mm", "20mm", "寄");
           LODOP.SET_PRINT_STYLE('FontSize', 12);
           LODOP.ADD_PRINT_TEXT("101mm", "15mm", "20mm", "5mm", fname);//1行 寄件人
           LODOP.ADD_PRINT_TEXT("101mm", "35mm", "80mm", "5mm", ftel1);//1行 寄件人电话
           LODOP.ADD_PRINT_TEXT("107mm", "15mm", "90mm", "10mm", "江苏省 苏州市 太仓市新亚路2号");//1行 寄件人电话
           LODOP.ADD_PRINT_TEXT("113mm", "15mm", "90mm", "5mm", "苏州新亚科技有限公司");//1行 寄件人电话




           //第8块自定义
           var myDate = new Date().toLocaleString();
           LODOP.SET_PRINT_STYLE('FontSize', 10);
            var fkfs = "";
           if ('@Model.payType' == "2") {
               fkfs = "收方付 (到付)";
           } else {
               fkfs = "寄方付";
           }
           LODOP.ADD_PRINT_TEXT("122mm", "5mm", "35mm", "5mm", "付款方式：" + fkfs);//
           LODOP.ADD_PRINT_TEXT("122mm", "40mm", "35mm", "5mm", "实际重量：");//
           LODOP.ADD_PRINT_TEXT("128mm", "5mm", "35mm", "5mm", "费用合计：");//
           LODOP.ADD_PRINT_TEXT("128mm", "40mm", "35mm", "5mm", "托寄物品："+'@Model.cargoName');//
           LODOP.ADD_PRINT_TEXT("133mm", "5mm", "20mm", "18mm", "备注：");
           LODOP.ADD_PRINT_TEXT("145mm", "5mm", "100mm", "20mm", "客户订单号："+'@Model.logisticID');


    };
  var loadi;
           function ddchen() {
               loadi = layer.load(1, { shade: [0.8, '#393D49'] })
    };
           //关闭等待效果
           function disLoading() {
               layer.close(loadi);
    };



    //订单撤销
    function revokeorders() {
         $.ajax({
            url: "../EP_jlinfo/DBrevokeorders",
            type: "POST",
            dataType: "JSON",
            async: true,
            beforeSend: function () {
                ddchen();
            },
            data: {"Id":'@Model.Id'} ,
                   success: function (response) {
                       disLoading();
                       if(response.result=="true")
                       {
                           layer.alert(response.msg, { icon: 1 }, function () {  location.reload();});
                       }
                       if(response.result=="false") {
                           layer.alert(response.msg, { icon: 2 });
                       }

                   },
                   error: function (e) {
                       disLoading();
                       layer.alert("操作失败！", { icon: 2 });
                   }
               })
        };

    //关闭页面
        function Closetk() {
             layer.close()
        }

                 //订单撤销
    function revokeorders() {
         $.ajax({
             url: "../EP_jlinfo/SFrevokeorders",
            type: "POST",
            dataType: "JSON",
            async: true,
            beforeSend: function () {
                ddchen();
            },
            data: {"Id":'@Model.Id'} ,
                   success: function (response) {
                       disLoading();
                       if(response.result=="true")
                       {
                           layer.alert(response.msg, { icon: 1 }, function () {  location.reload();});
                       }
                       if(response.result=="false") {
                           layer.alert(response.msg, { icon: 2 });
                       }

                   },
                   error: function (e) {
                       disLoading();
                       layer.alert("操作失败！", { icon: 2 });
                   }
               })
        };
    </script>
}


<div style="width: 100%; height: auto; overflow: hidden; padding:10px 10px">

    @{
        if (Model.logisticID == null)
        {
            <fieldset class="layui-elem-field">
                <legend>快递基础信息</legend>
                <div class="layui-field-box">

                    <ul>
                        <li>
                            <span>支付方式：</span>
                            <span class="inquiry-input">
                                <select id="txtpayType" name="txtpayType" style="width:120px">
                                    <option value="2">发货人付款（月结）</option>
                                    <option value="1">收货人付款（到付）</option>
                                    <option value="0">发货人付款（现付）</option>
                                </select>
                            </span>
                        </li>
                        <li>
                            <span>运输方式：</span>
                            <span class="inquiry-input">
                                <select id="txttransportType" name="txttransportType" style="width:120px">
                                    <option value="RCP">大件快递360</option>
                                    <option value="NZBRH">重包入户</option>
                                    <option value="ZBTH">重包特惠</option>
                                    <option value="WXJTH">微小件特惠</option>
                                    <option value="JJDJ">经济大件</option>
                                    <option value="PACKAGE">标准快递</option>
                                    <option value="DEAP">特准快件</option>
                                    <option value="EPEP">电商尊享</option>
                                    <option value="CITYPIECE">同城件</option>
                                    <option value="JZKY">精准空运</option>
                                </select>
                            </span>
                        </li>

                        <li>
                            <span>送货方式：</span>
                            <span class="inquiry-input">
                                <select id="txtdeliveryType" name="txtdeliveryType" style="width:120px">
                                    <option value="2">送货进仓</option>
                                    <option value="3">送货（不含上楼</option>
                                    <option value="4">送货上楼</option>
                                    <option value="5">大件上楼</option>
                                    <option value="1">自提</option>
                                </select>
                            </span>
                        </li>


                        <li>
                            <span>货物名称：</span>
                            <span class="inquiry-input">
                                <input type="text" name="txtcargoName" id="txtcargoName" value="文件" />
                            </span>
                        </li>
                        @*<li>
                                <span>快递数量：</span>
                                <span class="inquiry-input">
                                    <input type="text" name="txtDHno" id="txtDHno" value="1" />
                                </span>
                            </li>*@
                        <li>
                            <span>总重量：</span>
                            <span class="inquiry-input">
                                <input type="text" name="txttotalWeight" id="txttotalWeight" value="1" /> / KG
                            </span>
                        </li>
                        <li>
                            <span>保价金额：</span>
                            <span class="inquiry-input">
                                <input type="text" name="txtinsuranceValue" id="txtinsuranceValue" value="0" />
                            </span>
                        </li>
                    </ul>
                </div>
            </fieldset>
        }
        else if (Model.Istscg == 0)
        {
            <blockquote class="layui-elem-quote">
                <span style="color:#FF5722">
                    订单下单成功!
                </span>预埋单号：@Model.Kd_no  <br />
                业务流水号：@Model.logisticID <br />
                下单时间：@Model.Jjdatetime<br />
                请点击打印，如果要取消下单，请点击下方取消订单按钮
            </blockquote>


        }
        else if (Model.Istscg == 2)
        {
            <blockquote class="layui-elem-quote">
                <span style="color:#FF5722">
                    订单已经撤销!
                </span>
            </blockquote>
        }
    }

    <div class="" style="text-align:center">

        @{
            if (Model.logisticID == null)
            {
                <span>
                    @*<button onclick="return tsdyorder()" class="layui-btn layui-btn-normal">云下单</button>*@
                </span>
            }
            else if (Model.Istscg == 0)
            {
                <span>
                    <button onclick="return myPreview()" class="layui-btn layui-btn-normal">电子面单打印</button>
                </span>
                <span>
                    <button onclick="return revokeorders()" class="layui-btn layui-btn-danger">订单取消</button>
                </span>
            }

        }

 
    </div>
</div>

<style>
    .layui-field-box ul li {
        float: left;
        margin-left: 2px;
        padding-bottom: 5px;
    }

        .layui-field-box ul li span {
            font-size: 12px;
        }
</style>
